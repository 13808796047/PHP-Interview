## 架构和设计

架构和设计是面试中经常用到的，一是考察你的知识面，而是考察你接触的系统的复杂程序。本文可能介绍一些相关的问题。

### 1. 数据库结构设计

- 主从复制
- 分库分表
- 双主互备
- 数据库中间件



为了解决单表数据过多，一般会采取分片【分库分表】水平切分，分片会产生路由，上层应用要知道数据在哪一个库中。

路由规则常用的有三种方法

- range 范围

- 哈希
- 路由服务

#### 可用性

为了解决单点的故障，一般引入**主从复制**，也就是垂直分割。

采取**双主互备**【keplived】，冗余写库，双主当主从用 

解决同步冲突，有两种常见解决方案 

- 两个写库设置不同的初始化，相同步长增加id
- 业务层自己生成唯一的id，保证数据不冲突 

#### 一致性

主从数据库的一致性，通常有两种解决方案： 

- 中间件

中间件屏蔽了集群了，对外伪装成一个server。

- 强制读主

### SESSION架构设计

服务器为每个用户创建一个会话，存储用户的相关信息，以便多次请求能够定位到同一个上下文。 只要用户不重启浏览器，会话就一直存在。

- session同步法：多台web-server相互同步数据 
- 客户端存储法：一个用户只存储自己的数据
-  反向代理hash一致性：四层hash和七层hash都可以做，保证一个用户的请求落在一台web-server上 
- 后端统一存储：web-server重启和扩容，session也不会丢失 

